# Add executable called "operatiom" that is built from the source files
# "operation.cxx"". The extensions are automatically found.
#

add_executable(operation main.cpp)

# Link the executable to the operation library. Since the operation library has
# public include directories we will use those link directories when building
# operation
#

target_link_libraries(operation LINK_PUBLIC operationlib)

# add a target to generate API documentation with Doxygen
option(BUILD_DOCUMENTATION "Use Doxygen to create the HTML based API documentation" OFF)
if(BUILD_DOCUMENTATION)
find_package(Doxygen)
  if(NOT DOXYGEN_FOUND)
    message(FATAL_ERROR
      "Doxygen is needed to build the documentation. Please install it correctly")
  endif()
  
  SET( doxyfile_in          ${CMAKE_CURRENT_SOURCE_DIR}/Doxyfile.in     )
  SET( doxyfile             ${CMAKE_CURRENT_SOURCE_DIR}/Doxyfile              )
  SET( doxy_html_index_file ${CMAKE_CURRENT_BINARY_DIR}/html/index.html )
  SET( doxy_output_root     ${CMAKE_CURRENT_BINARY_DIR}                 ) 
  SET( doxy_input           ${CMAKE_CURRENT_SOURCE_DIR}/src                   ) 
  SET( doxy_extra_files     ${CMAKE_CURRENT_SOURCE_DIR}/mainpage.dox    )

  # configure_file(${CMAKE_CURRENT_SOURCE_DIR}/Doxyfile.in 
  #                     ${CMAKE_CURRENT_BINARY_DIR} /Doxyfile @ONLY)
  CONFIGURE_FILE( ${doxyfile_in} ${doxyfile} @ONLY )
  #add_custom_target(doc ALL
   #          COMMAND ${DOXYGEN_EXECUTABLE} ${CMAKE_CURRENT_BINARY_DIR}/Doxyfile
    #           WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
     #             COMMENT "Generating API documentation with Doxygen" VERBATIM)
  ADD_CUSTOM_COMMAND( OUTPUT ${doxy_html_index_file}
                      COMMAND ${DOXYGEN_EXECUTABLE} ${doxyfile}
                       MAIN_DEPENDENCY ${doxyfile} ${doxyfile_in}
                      DEPENDS project_targets ${doxy_extra_files}
                      COMMENT "Generating HTML documentation")

 ADD_CUSTOM_TARGET( doc ALL DEPENDS ${doxy_html_index_file} )

INSTALL( DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/html DESTINATION share/doc )
                 
  #Doxygen will be triggered every time we run make
  # IF you do NOT want the documentation to be generated EVERY time you build the project
  # then leave out the 'ALL' keyword from the above command.                
endif()


